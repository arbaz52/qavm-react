(this["webpackJsonpqavm-reactjs"]=this["webpackJsonpqavm-reactjs"]||[]).push([[0],{137:function(e,t,a){e.exports=a(199)},142:function(e,t,a){},143:function(e,t,a){},146:function(e,t,a){},175:function(e,t,a){},176:function(e,t,a){},177:function(e,t,a){},178:function(e,t,a){},179:function(e,t,a){},180:function(e,t,a){},199:function(e,t,a){"use strict";a.r(t);var n=a(1),c=a.n(n),l=a(26),r=a.n(l),i=(a(142),a(18)),o=(a(143),a(144),a(145),a(35)),s=a(202),m=a(203),u=a(204),d=a(205),f=a(206),p=a(207),E=a(127),g=a(219),b=a(221),v=a(220),h=a(208),j=(a(146),a(33)),O=function(){var e=Object(n.useContext)(ne),t=e.username,a=e.logout,l=e.setAskForUsername,r=(e.askForUsername,Object(n.useState)(!1)),o=Object(i.a)(r,2),O=o[0],y=o[1];return Object(n.useContext)(ce).showHeader&&c.a.createElement("header",{className:"container sticky-top"},c.a.createElement(s.a,{expand:"md",light:!0},c.a.createElement(m.a,{tag:j.b,to:"/",className:"mx-2 text-primary"},"qavm"),c.a.createElement(u.a,{onClick:function(){y(!O)}}),c.a.createElement(d.a,{isOpen:O,navbar:!0},c.a.createElement(f.a,{navbar:!0,className:"ml-auto"},c.a.createElement(p.a,null,c.a.createElement(j.b,{to:"/join",className:"mx-2 text-primary"},"Join a meeting")),c.a.createElement(p.a,null,c.a.createElement(j.b,{to:"/host",className:"mx-2 text-primary"},"Host a meeting")))),c.a.createElement(d.a,{isOpen:O,navbar:!0},c.a.createElement(f.a,{navbar:!0,className:"ml-auto"},t?c.a.createElement(p.a,null,c.a.createElement(g.a,null,c.a.createElement(b.a,{nav:!0,caret:!0},t),c.a.createElement(v.a,{right:!0},c.a.createElement(h.a,{onClick:function(e){a(),l(!0)}},"Not ",t,"?")))):c.a.createElement(p.a,null,c.a.createElement(E.a,{color:"primary",style:{borderRadius:75,overflow:"none"},onClick:function(e){l(!0)}},"Get Started"))))))},y=a(13),k=a(209),N=function(){return c.a.createElement("section",{className:"row justify-content-center align-items-center"},c.a.createElement("div",{className:"py-5 col-sm-12 col-md-6"},c.a.createElement("img",{src:"undraw_video_call_kxyp.svg",alt:"",className:"img-fluid"})),c.a.createElement("div",{className:"py-5 col-sm-12 col-md-6"},c.a.createElement("h1",null,c.a.createElement("strong",null,"QAVM")),c.a.createElement("p",{className:"lead"},"Quick Audio Video Meetings"),c.a.createElement("p",{className:"text-muted"},"Lorem ipsum dolor sit amet consectetur adipisicing elit. Assumenda temporibus provident, labore nobis, nostrum praesentium quidem ea optio vero molestias nisi, quia explicabo cumque dignissimos sit similique officiis unde doloremque!"),c.a.createElement(k.a,null,c.a.createElement(E.a,{tag:j.b,to:"/join",color:"info"},"Join a meeting"),c.a.createElement(E.a,{tag:j.b,to:"/host",color:"primary"},"Host a meeting"))))},x=function(){return c.a.createElement(c.a.Fragment,null,c.a.createElement(N,null))},w=a(21),S=a(217),C=a(210),_=a(211),I=a(212),q=a(213),A=a(214),L=a(39),F=function(){var e=Object(n.useState)(!1),t=Object(i.a)(e,2),a=t[0],l=t[1],r=Object(n.useContext)(ne),o=(r.username,r.logout,r.askForUsername),s=r.setAskForUsername,m=r.login,u=L.a({username:L.b().required()});return c.a.createElement(S.a,{isOpen:o,centered:!0},c.a.createElement(C.a,null,"Let's get started!"),c.a.createElement(_.a,null,c.a.createElement(w.d,{initialValues:{username:""},validationSchema:u,onSubmit:function(e){var t=e.username;console.log(t),l(!0),m(t).then((function(e){l(!1),s(!1)})).catch((function(e){l(!1)})).finally()}},c.a.createElement(w.c,null,c.a.createElement(I.a,{className:""},c.a.createElement(q.a,null,"What should i call you?"),c.a.createElement(w.b,{as:A.a,name:"username"}),c.a.createElement(w.a,{name:"username"},(function(e){return c.a.createElement("div",{className:"alert alert-danger mt-2"},e)}))),c.a.createElement(I.a,{className:"text-right"},c.a.createElement(E.a,{color:"",type:"button",disabled:a,onClick:function(e){return s(!1)}},"Cancel")," "," ",c.a.createElement(E.a,{color:"primary",type:"submit",disabled:a},"Let's get started!"))))))},M=function(){var e=Object(y.f)(),t=Object(n.useState)(null),a=Object(i.a)(t,2),l=a[0],r=a[1],o=Object(n.useState)(!1),s=Object(i.a)(o,2),m=s[0],u=s[1],d=Object(n.useContext)(ne),f=d.setAskForUsername,p=d.username,g=d.hostMeeting,b=L.a({title:L.b().required()});return Object(n.useEffect)((function(){p||f(!0)}),[]),c.a.createElement(c.a.Fragment,null,c.a.createElement("section",{className:"row justify-content-center align-items-center my-5"},c.a.createElement("div",{className:"py-5 col-sm-12 col-md-6"},c.a.createElement("img",{src:"undraw_shared_workspace_hwky.svg",alt:"",className:"img-fluid"})),c.a.createElement("div",{className:"py-5 col-sm-12 col-md-6"},c.a.createElement("h1",null,c.a.createElement("strong",null,"Host a meeting!")),c.a.createElement("p",{className:"text-muted"},"Let's start connecting with people that matter!"),c.a.createElement(w.d,{initialValues:{title:""},validationSchema:b,onSubmit:function(t){var a=t.title;console.log("host meeting!"),u(!0),r(null),g(a).then((function(t){console.log(t),u(!1),e.push("./meeting/"+t._id)})).catch((function(e){console.error(e),u(!1),r(e)})).finally()}},c.a.createElement(w.c,null,c.a.createElement(I.a,null,c.a.createElement(q.a,null,"Title for this meeting"),c.a.createElement(w.b,{as:A.a,name:"title"}),c.a.createElement(w.a,{name:"title"},(function(e){return c.a.createElement("div",{className:"alert alert-danger mt-2"},e)}))),c.a.createElement(I.a,{className:"text-right"},c.a.createElement(E.a,{color:"primary",disabled:m},"Start Meeting!")))),l&&c.a.createElement("div",{className:"alert alert-danger mt-2"},l))))},P=function(){return c.a.createElement(c.a.Fragment,null,c.a.createElement(M,null))},V=function(){Object(y.f)();var e=Object(n.useContext)(ne),t=e.setAskForUsername,a=e.username,l=L.a({link:L.b().required()});return Object(n.useEffect)((function(){a||t(!0)}),[]),c.a.createElement(c.a.Fragment,null,c.a.createElement("section",{className:"row justify-content-center align-items-center my-5"},c.a.createElement("div",{className:"py-5 col-sm-12 col-md-6"},c.a.createElement("img",{src:"undraw_online_connection_6778.svg",alt:"",className:"img-fluid"})),c.a.createElement("div",{className:"py-5 col-sm-12 col-md-6"},c.a.createElement("h1",null,c.a.createElement("strong",null,"Join a meeting!")),c.a.createElement("p",{className:"text-muted"},"Did someone share a link with you to connect with them through this sweet website?"),c.a.createElement(w.d,{initialValues:{link:""},validationSchema:l,onSubmit:function(e){var t=e.link;console.log("joining meeting!"),window.location.href=t}},c.a.createElement(w.c,null,c.a.createElement(I.a,null,c.a.createElement(q.a,null,"Invite link?"),c.a.createElement(w.b,{as:A.a,name:"link"}),c.a.createElement(w.a,{name:"link"},(function(e){return c.a.createElement("div",{className:"alert alert-danger"},e)}))),c.a.createElement(I.a,{className:"text-right"},c.a.createElement(E.a,{color:"primary"},"Join Meeting!")))))))},T=function(){return c.a.createElement(c.a.Fragment,null,c.a.createElement(V,null))},U=a(80),H=a(16),R=a(105),z=(a(175),a(176),a(55)),J=function(e){var t=e.username,a=e.audio,l=e.audioTrack,r=e.video,i=e.toggleAudio,o=e.toggleVideo,s=e.local,m=Object(n.useRef)(null);return Object(n.useEffect)((function(){a&&m.current&&(m.current.srcObject=new MediaStream([l]))}),[a,m]),i=i||function(){},o=o||function(){},c.a.createElement("div",{className:"mt-3 p"},a&&!s&&c.a.createElement("audio",{ref:m,autoPlay:!0}),c.a.createElement("p",{className:"m-0",style:{fontWeight:s?"bold":"normal"}},t||"Participant"),c.a.createElement("div",{className:"icons"},r?c.a.createElement("div",{className:"badge badge-info btn",onClick:o},c.a.createElement(z.d,null)):c.a.createElement("div",{className:"badge badge-danger btn",onClick:o},c.a.createElement(z.e,null)),a?c.a.createElement("div",{className:"badge badge-info btn",onClick:i},c.a.createElement(z.b,null)):c.a.createElement("div",{className:"badge badge-danger btn",onClick:i},c.a.createElement(z.c,null))))},B=function(e){var t=e.video,a=e.videoTrack,l=Object(n.useRef)(null);return Object(n.useEffect)((function(){t&&l&&(l.current.srcObject=new MediaStream([a]))}),[t,l]),c.a.createElement("div",{className:"local-participant-wrapper"},t&&c.a.createElement("video",{ref:l,muted:!0,autoPlay:!0,className:"img-fluid"}),c.a.createElement(J,e),c.a.createElement("div",{className:"text-center mt-3"},c.a.createElement(E.a,{color:"danger",size:"sm"},"Leave Meeting")))},Q=(a(177),function(e){var t=e.participants;return c.a.createElement("div",{className:"participants-list-wrapper"},c.a.createElement("div",{className:"participants-list-content"},t.map((function(e){return c.a.createElement(J,Object.assign({key:e.user_id},e))}))))}),W=a(215),D=a(218),G=a(216),K=a(134),X=(a(178),a(179),function(e){var t=e._id,a=e.title,l=Object(n.useContext)(ce),r=l.showHeader,i=l.setShowHeader;return c.a.createElement("div",{className:"meeting-info"},c.a.createElement("h3",null,c.a.createElement("span",{className:""},a)),c.a.createElement("ul",null,c.a.createElement("li",null,c.a.createElement(E.a,{color:"link",size:"sm",onClick:function(e){return i(!r)},style:{marginRight:10}},c.a.createElement(z.a,null))),c.a.createElement("li",null,c.a.createElement(E.a,{color:"primary",size:"sm",onClick:function(){navigator.clipboard.writeText("http://localhost:3000/meeting/"+t),o.b.info("Invitation link copied to clipboard",{position:"bottom-right"})}},"Invitation link"))))}),Y=(a(180),function(e){var t=e.video,a=e.videoTrack,l=e.username,r=e.showInfo,i=e.onClick,o=Object(n.useRef)(null);return Object(n.useEffect)((function(){t&&o&&(o.current.srcObject=new MediaStream([a]))}),[t,o]),c.a.createElement(c.a.Fragment,null,t&&c.a.createElement("div",{onClick:i},c.a.createElement("video",{ref:o,muted:!0,autoPlay:!0,className:"img-fluid rounded"}),(r||!0)&&c.a.createElement("p",{className:"text-muted"},l||"Participant")))}),Z=a(133),$=a(56),ee=a.n($),te=a(135),ae=function(e){var t=e.match.params.meetingId,a=Object(n.useContext)(ce).setShowHeader,l=Object(n.useContext)(ne),r=l.username,s=l.setAskForUsername,m=Object(n.useContext)(le).getMeetingInfo;Object(n.useEffect)((function(){r||s(!0)}),[]);var u=Object(n.useState)(null),d=Object(i.a)(u,2),f=d[0],p=d[1];Object(n.useEffect)((function(){t&&(console.log("Loading user data",t),m(t).then((function(e){console.log(e),p(e)})).catch((function(e){console.error(e)})).finally((function(){a(!1)})))}),[t]);var g=Object(n.useState)(Z.a.createCallObject()),b=Object(i.a)(g,2),v=b[0];b[1];Object(n.useEffect)((function(){r&&f&&console.log("all good to go!")}),[r,f]);var h=Object(n.useState)([]),j=Object(i.a)(h,2),O=j[0],y=j[1],k=Object(n.useState)(null),N=Object(i.a)(k,2),x=N[0],w=N[1];Object(n.useEffect)((function(){console.log("par updated",O);var e,t=Object(R.a)(O);try{for(t.s();!(e=t.n()).done;){var a=e.value;a.local&&w(a)}}catch(n){t.e(n)}finally{t.f()}}),[O]);var S=Object(n.useState)(null),C=Object(i.a)(S,2),_=C[0],I=C[1],q=Object(n.useRef)(null),L=Object(n.useRef)(null),F=Object(n.useRef)(null),M=function(e){ee.a.get("https://qavm-server.herokuapp.com/users/callerId/"+e).then((function(t){y((function(a){return a.map((function(a){return a.user_id==e?Object(H.a)(Object(H.a)({},a),t.data):a}))})),console.log(t)})).catch((function(e){console.log(e)})).finally()};Object(n.useEffect)((function(){if(r&&v&&f){console.log("working",r);for(var e=function(e){switch(console.log(e),e.action){case"joined-meeting":o.b.info(e.action.replace("-"," ")),v.setLocalAudio(!1),v.setLocalVideo(!1);var t=e.participants.local.user_id;ee.a.put("https://qavm-server.herokuapp.com/users/callerId",{callerId:t},{headers:re()}).then((function(e){console.log(e),setTimeout((function(){v.sendAppMessage({type:"update-my-info",by:t})}),3e3)})).catch().finally(),y(Object(U.a)(Object.keys(e.participants).map((function(t){return setTimeout((function(){M(e.participants[t].user_id)}),3e3),e.participants[t]}))));break;case"joining-meeting":o.b.info(e.action.replace("-"," ")+", please wait!");break;case"left-meeting":o.b.info(e.action.replace("-"," "));break;case"app-message":o.b.info(e);break;case"participant-joined":o.b.info(e.action.replace("-"," ")),y((function(t){return setTimeout((function(){M(e.participant.user_id)}),3e3),[].concat(Object(U.a)(t),[e.participant])}));break;case"participant-left":o.b.info(e.action.replace("-"," ")),y((function(t){return Object(U.a)(t.filter((function(t){return t.user_id!=e.participant.user_id})))}));break;case"participant-updated":y((function(t){return Object(U.a)(t.map((function(t){return t.user_id==e.participant.user_id?(t.username||setTimeout((function(){M(e.participant.user_id)}),3e3),Object(H.a)(Object(H.a)({},t),e.participant)):t})))}))}},t=["app-message","joining-meeting","joined-meeting","left-meeting","participant-joined","participant-left","participant-updated"],a=0,n=t;a<n.length;a++){var c=n[a];v.on(c,e)}return v.join({url:f.room.url}),function(){console.log("un binding");var a,n=Object(R.a)(t);try{for(n.s();!(a=n.n()).done;){var c=a.value;v.off(c,e)}}catch(l){n.e(l)}finally{n.f()}}}}),[v,r,f]);return f?c.a.createElement("div",{className:"content"},c.a.createElement("div",{className:"left"},c.a.createElement("form",{className:"search px-4 py-2 mt-1"},c.a.createElement(W.a,null,c.a.createElement(A.a,{type:"search",placeholder:"Search for participants...",bsSize:"sm"}),c.a.createElement(D.a,{addonType:"append",size:"sm"},c.a.createElement(E.a,{color:"primary",size:"sm"},c.a.createElement(K.a,null))))),c.a.createElement("div",{className:"participants px-4 py-2"},c.a.createElement(Q,{participants:O.filter((function(e){return!0}))})),c.a.createElement("div",{className:"local px-5 py-3"},c.a.createElement(B,Object.assign({},x,{toggleAudio:function(){console.log("toggleAudio"),v&&v.setLocalAudio(!v.localAudio())},toggleVideo:function(){console.log("toggleVideo"),v&&v.setLocalVideo(!v.localVideo())}})))),c.a.createElement("div",{className:"right"},c.a.createElement("div",{className:"header px-4 py-2"},c.a.createElement(X,{title:f.title,_id:f._id})),c.a.createElement("div",{className:"videos-wrapper no-focus px-4 py-2",ref:q},c.a.createElement("div",{className:"focus-participant no-focus",ref:L},c.a.createElement("div",{className:"d-flex mb-3 justify-content-end"},c.a.createElement(E.a,{color:"link",onClick:function(){q.current.classList.add("no-focus"),L.current.classList.add("no-focus"),F.current.classList.add("no-focus"),I(null)}},c.a.createElement(te.a,null))),c.a.createElement(Y,Object.assign({},_,{showInfo:!1}))),c.a.createElement("div",{className:"videos-holder no-focus",ref:F},O.map((function(e){return c.a.createElement(Y,Object.assign({},e,{onClick:function(t){return a=e,q.current.classList.remove("no-focus"),L.current.classList.remove("no-focus"),F.current.classList.remove("no-focus"),void I(a);var a}}))})))))):c.a.createElement("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100px"}},c.a.createElement("p",{className:"lead mb-5 text-center"},"Please wait, loading meeting details",c.a.createElement("br",null),c.a.createElement(G.a,null)))},ne=Object(n.createContext)(null),ce=Object(n.createContext)(!1),le=Object(n.createContext)(null),re=function(){var e=localStorage.getItem("token");return e?{authorization:"Bearer "+e}:{}};var ie=function(){var e=Object(y.f)(),t=Object(n.useState)(localStorage.getItem("username")),a=Object(i.a)(t,2),l=a[0],r=a[1],s=Object(n.useState)(!1),m=Object(i.a)(s,2),u=m[0],d=m[1],f=Object(n.useState)(!0),p=Object(i.a)(f,2),E=p[0],g=p[1];return c.a.createElement(le.Provider,{value:{getMeetingInfo:function(e){return new Promise((function(t,a){ee.a.get("https://qavm-server.herokuapp.com/meetings/"+e,{headers:re()}).then((function(e){t(e.data)})).catch((function(e){a(e.message)})).finally((function(){}))}))}}},c.a.createElement(ce.Provider,{value:{showHeader:E,setShowHeader:g}},c.a.createElement(o.a,null),c.a.createElement(ne.Provider,{value:{username:l,setUsername:r,logout:function(){r(null),localStorage.removeItem("username"),localStorage.removeItem("token")},askForUsername:u,setAskForUsername:d,login:function(e){return new Promise((function(t,a){ee.a.post("https://qavm-server.herokuapp.com/users/",{username:e}).then((function(e){localStorage.setItem("username",e.data.user.username),localStorage.setItem("token",e.data.token),r(e.data.user.username),t("username")})).catch((function(e){a(e.message)})).finally()}))},hostMeeting:function(t){return new Promise((function(a,n){ee.a.post("https://qavm-server.herokuapp.com/meetings/",{title:t},{headers:re()}).then((function(t){a(t.data),e.push("./meetings/"+t.data._id)})).catch((function(e){n(e.message)})).finally((function(){}))}))}}},c.a.createElement(j.a,null,c.a.createElement(F,null),c.a.createElement(O,null),c.a.createElement("div",{className:"container"},c.a.createElement(y.c,null,c.a.createElement(y.a,{path:"/",component:x,exact:!0}),c.a.createElement(y.a,{path:"/join",component:T,exact:!0}),c.a.createElement(y.a,{path:"/host",component:P,exact:!0}),c.a.createElement(y.a,{path:"/meeting/:meetingId",component:ae,exact:!0})))))))};r.a.render(c.a.createElement(ie,null),document.getElementById("root"))}},[[137,1,2]]]);
//# sourceMappingURL=main.18f5f4b4.chunk.js.map